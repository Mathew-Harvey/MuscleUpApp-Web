<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Ring Muscle Up — The Complete Training Guide</title>
<link rel="icon" href="assets/images/coverpage.png" type="image/png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,500&family=Source+Sans+3:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
/* ================================================================
   EBOOK READER — The Ring Muscle Up
   Scroll-based reader with sidebar TOC, themes, responsive
   ================================================================ */

/* ===== THEME VARIABLES ===== */
:root, [data-theme="light"] {
  --bg: #ffffff;
  --text: #334155;
  --heading: #0f172a;
  --heading2: #1e3a5f;
  --sub: #64748b;
  --border: #e2e8f0;
  --accent: #c8a55c;
  --accent-soft: rgba(200,165,92,0.12);
  --exbox-bg: #fafaf9;
  --table-header-bg: #0f172a;
  --table-header-text: #fff;
  --link: #c8a55c;
  --shadow: 0 1px 3px rgba(0,0,0,0.06);
}
[data-theme="sepia"] {
  --bg: #f8f1e3;
  --text: #5b4636;
  --heading: #3e2c1c;
  --heading2: #4a3728;
  --sub: #7a6652;
  --border: #d4c4a0;
  --accent: #a07830;
  --accent-soft: rgba(160,120,48,0.12);
  --exbox-bg: #f0e8d6;
  --table-header-bg: #3e2c1c;
  --table-header-text: #f8f1e3;
  --link: #a07830;
  --shadow: 0 1px 3px rgba(0,0,0,0.08);
}
[data-theme="dark"] {
  --bg: #16162a;
  --text: #cbd5e1;
  --heading: #f1f5f9;
  --heading2: #e2e8f0;
  --sub: #94a3b8;
  --border: #2d2d4a;
  --accent: #d4b76a;
  --accent-soft: rgba(212,183,106,0.12);
  --exbox-bg: #1e1e38;
  --table-header-bg: #0f0f24;
  --table-header-text: #e2e8f0;
  --link: #d4b76a;
  --shadow: 0 1px 4px rgba(0,0,0,0.3);
}

/* Chrome (toolbar, sidebar) — always dark */
:root {
  --chrome-bg: #0a0a0a;
  --chrome-text: #f0ede8;
  --chrome-muted: #8a857d;
  --chrome-dim: #5a5650;
  --chrome-border: rgba(255,255,255,0.06);
  --chrome-hover: rgba(255,255,255,0.06);
  --chrome-accent: #c8a55c;
  --font-heading: 'Plus Jakarta Sans', -apple-system, sans-serif;
  --font-body: 'Source Sans 3', -apple-system, sans-serif;
  --font-scale: 1;
}

/* ===== RESET ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 16px; height: 100%; -webkit-text-size-adjust: 100%; }
body {
  font-family: var(--font-body);
  color: var(--text);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  background: var(--chrome-bg);
  height: 100%;
  overflow: hidden;
  margin: 0;
}
img { max-width: 100%; height: auto; display: block; }
a { color: var(--link); }

/* ===== AUTH GATE ===== */
#auth-gate {
  position: fixed; inset: 0; z-index: 9999;
  background: #0a0a0a;
  display: flex; align-items: center; justify-content: center;
  flex-direction: column; text-align: center; padding: 2rem;
}
#auth-gate.hidden { display: none; }
.gate-icon {
  width: 72px; height: 72px; border: 2px solid var(--chrome-accent);
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  margin-bottom: 1.5rem;
}
.gate-icon svg { width: 32px; height: 32px; stroke: var(--chrome-accent); fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
.gate-title {
  font-family: var(--font-heading); font-size: 1.5rem; font-weight: 800;
  color: #fff; margin-bottom: 0.5rem;
}
.gate-message { font-size: 1rem; color: #8a857d; max-width: 400px; margin-bottom: 2rem; line-height: 1.6; }
.gate-message.error { color: #f87171; }
.gate-btn {
  display: inline-block; padding: 12px 32px; background: var(--chrome-accent);
  color: #0a0a0a; font-family: var(--font-heading); font-weight: 700;
  font-size: 0.9rem; text-decoration: none; border-radius: 8px;
  transition: background 0.2s;
}
.gate-btn:hover { background: #d4b76a; }
.gate-spinner {
  width: 40px; height: 40px; border: 3px solid #222;
  border-top-color: var(--chrome-accent); border-radius: 50%;
  animation: spin 0.8s linear infinite; margin-bottom: 1rem;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== READER SHELL ===== */
#reader { display: none; flex-direction: column; height: 100vh; height: 100dvh; width: 100vw; overflow: hidden; }
#reader.active { display: flex; }

/* ===== PROGRESS BAR ===== */
#progress-bar {
  height: 3px; background: rgba(255,255,255,0.06);
  flex-shrink: 0; position: relative; z-index: 110;
}
#progress-fill {
  height: 100%; width: 0%; background: var(--chrome-accent);
  transition: width 0.15s ease-out;
}

/* ===== TOOLBAR ===== */
#toolbar {
  height: 56px; flex-shrink: 0;
  background: var(--chrome-bg);
  border-bottom: 1px solid var(--chrome-border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 16px; z-index: 100;
  user-select: none; -webkit-user-select: none;
}
.toolbar-left, .toolbar-right { display: flex; align-items: center; gap: 4px; }
.toolbar-title-area { flex: 1; min-width: 0; padding: 0 12px; }
.toolbar-chapter {
  font-family: var(--font-heading); font-size: 0.85rem; font-weight: 600;
  color: var(--chrome-text); white-space: nowrap; overflow: hidden;
  text-overflow: ellipsis; display: block;
}
.toolbar-sub {
  font-size: 0.7rem; color: var(--chrome-muted);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.tb-btn {
  width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
  border: none; background: transparent; cursor: pointer; border-radius: 8px;
  transition: background 0.15s; color: var(--chrome-text); padding: 0; flex-shrink: 0;
}
.tb-btn:hover { background: var(--chrome-hover); }
.tb-btn svg {
  width: 20px; height: 20px; stroke: currentColor; fill: none;
  stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
}

/* ===== READER BODY (sidebar + content) ===== */
#reader-body { flex: 1; display: flex; overflow: hidden; min-height: 0; }

/* ===== TOC SIDEBAR ===== */
#toc-sidebar {
  width: 280px; flex-shrink: 0;
  background: var(--chrome-bg);
  border-right: 1px solid var(--chrome-border);
  display: flex; flex-direction: column;
  overflow: hidden;
  transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
#toc-sidebar.collapsed { margin-left: -280px; }

.toc-header {
  padding: 20px 24px 16px;
  border-bottom: 1px solid var(--chrome-border);
}
.toc-header h2 {
  font-family: var(--font-heading); font-size: 0.7rem; font-weight: 700;
  color: var(--chrome-muted); text-transform: uppercase; letter-spacing: 0.15em;
}
.toc-nav {
  flex: 1; overflow-y: auto; padding: 12px 0;
  scrollbar-width: thin; scrollbar-color: #333 transparent;
}
.toc-link {
  display: flex; align-items: center; gap: 12px;
  padding: 10px 24px; text-decoration: none;
  font-family: var(--font-body); font-size: 0.88rem; font-weight: 400;
  color: var(--chrome-muted); cursor: pointer;
  transition: color 0.15s, background 0.15s;
  border-left: 3px solid transparent;
}
.toc-link:hover { color: var(--chrome-text); background: var(--chrome-hover); }
.toc-link.active {
  color: var(--chrome-accent); font-weight: 600;
  border-left-color: var(--chrome-accent);
  background: rgba(200,165,92,0.06);
}
.toc-link .toc-num {
  font-family: var(--font-heading); font-size: 0.7rem; font-weight: 700;
  color: var(--chrome-dim); min-width: 22px;
}
.toc-link.active .toc-num { color: var(--chrome-accent); }
.toc-link-sub { padding-left: 60px; font-size: 0.82rem; }

/* Mobile overlay */
#toc-overlay {
  display: none; position: fixed; inset: 0; z-index: 199;
  background: rgba(0,0,0,0.6); opacity: 0; pointer-events: none;
  transition: opacity 0.3s;
}
#toc-overlay.visible { opacity: 1; pointer-events: auto; }

/* ===== CONTENT AREA ===== */
#content-area {
  flex: 1; overflow-y: auto; overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: contain;
  background: var(--bg);
  scroll-behavior: smooth;
}

/* ===== BOOK CONTENT ===== */

/* Cover Hero */
.cover-hero {
  position: relative; width: 100%;
  min-height: 70vh;
  background: #0a0a0a;
  display: flex; align-items: center; justify-content: center;
  overflow: hidden;
}
.cover-hero img {
  position: absolute; inset: 0; width: 100%; height: 100%;
  object-fit: cover; opacity: 0.35; filter: grayscale(30%);
}
.cover-overlay {
  position: absolute; inset: 0;
  background: linear-gradient(180deg, rgba(10,10,10,0.5) 0%, rgba(10,10,10,0.8) 60%, rgba(10,10,10,0.95) 100%);
}
.cover-content {
  position: relative; z-index: 1; text-align: center; padding: 3rem 2rem;
}
.cover-label {
  font-family: var(--font-heading); font-size: 1rem; font-weight: 800;
  color: #fff; letter-spacing: 0.2em; display: block; margin-bottom: 0.5rem;
}
.cover-title {
  font-family: var(--font-heading); font-size: clamp(2rem, 5vw, 3.5rem);
  font-weight: 800; color: #fff; letter-spacing: -0.02em;
  line-height: 1.1; margin-bottom: 1rem;
}
.cover-divider { width: 60px; height: 2px; background: var(--chrome-accent); margin: 0 auto 1rem; }
.cover-subtitle {
  font-family: var(--font-heading); font-size: 1rem; font-weight: 600;
  color: #c8a55c;
}
.cover-tagline {
  font-family: var(--font-body); font-size: 0.9rem; font-style: italic;
  color: #8a857d; margin-top: 0.5rem;
}
.cover-brand {
  margin-top: 2.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.75rem;
}
.cover-brand-line { width: 100px; height: 1px; background: var(--chrome-accent); opacity: 0.5; }
.cover-brand span {
  font-family: var(--font-heading); font-size: 0.65rem; font-weight: 700;
  color: var(--chrome-accent); letter-spacing: 0.25em; text-transform: uppercase;
}

/* Chapter Content Wrapper */
.chapter-content {
  max-width: 700px; margin: 0 auto;
  padding: 2.5rem 3rem 3rem;
  font-size: calc(1.0625rem * var(--font-scale));
  line-height: 1.8;
  color: var(--text);
}

/* Chapter Opener (dark bar) */
.chapter-opener {
  background: #0a0a0a; padding: 2rem 3rem; position: relative;
  border-bottom: 3px solid var(--chrome-accent);
}
.chapter-opener h1 {
  font-family: var(--font-heading); font-size: 1.75rem; font-weight: 800;
  color: #fff; letter-spacing: -0.01em; margin: 0;
}
.chapter-opener .ch-accent {
  width: 40px; height: 2px; background: var(--chrome-accent); margin: 0.5rem 0 0.25rem;
}
.chapter-opener .ch-subtitle {
  font-family: var(--font-body); font-size: 0.95rem; color: #8a857d; font-weight: 400;
}

/* Section within book content */
.book-section { border-bottom: 1px solid var(--border); }
.book-section:last-child { border-bottom: none; }

/* Typography in chapter-content */
.chapter-content h1 {
  font-family: var(--font-heading); font-size: 1.5rem; font-weight: 800;
  color: var(--heading); margin: 2rem 0 0.75rem; letter-spacing: -0.01em;
}
.chapter-content h2, .chapter-content .section-title {
  font-family: var(--font-heading); font-size: 1.15rem; font-weight: 700;
  color: var(--heading2); margin: 2.5rem 0 0.75rem;
}
.chapter-content h3 {
  font-family: var(--font-heading); font-size: 1rem; font-weight: 700;
  color: var(--accent); margin: 1.5rem 0 0.5rem;
}
.chapter-content p {
  margin-bottom: 1em; color: var(--text); font-weight: 400;
}
.chapter-content strong, .chapter-content b {
  font-weight: 600; color: var(--heading2);
}
.chapter-content a { color: var(--link); text-decoration-color: rgba(200,165,92,0.3); }
.chapter-content a:hover { text-decoration-color: var(--link); }

/* Level intro (italic) */
.level-intro {
  font-style: italic; color: var(--sub); margin-bottom: 1.5em;
  padding: 1rem 1.25rem; background: var(--accent-soft); border-radius: 8px;
  border-left: 3px solid var(--accent); line-height: 1.7;
}

/* ===== EXERCISE BLOCKS ===== */
.exercise-block {
  margin: 1.75rem 0; padding: 1.5rem; background: var(--bg);
  border: 1px solid var(--border); border-radius: 10px;
  box-shadow: var(--shadow);
}
.exercise-block h3 {
  margin: 0 0 0.75rem; font-size: 1.05rem;
}

/* Exercise images */
.exercise-img {
  margin: 1rem 0; border-radius: 8px; overflow: hidden;
}
.exercise-img img {
  width: 100%; border-radius: 8px;
  object-fit: contain; object-position: center;
}
.exercise-img-tall { max-width: 280px; margin-left: auto; margin-right: auto; }
.exercise-img-wide { max-width: 100%; }
.exercise-img-mu-hero { max-width: 100%; }

.exercise-sequence {
  display: grid; gap: 10px; margin: 1rem 0;
}
.exercise-sequence img {
  width: 100%; border-radius: 6px;
  object-fit: contain; object-position: center;
}
.exercise-sequence-2 { grid-template-columns: 1fr 1fr; }
.exercise-sequence-3 { grid-template-columns: 1fr 1fr 1fr; }
.exercise-sequence-4 { grid-template-columns: 1fr 1fr; }
.exercise-sequence-5 { grid-template-columns: 1fr 1fr 1fr; }

.exercise-sequence-caption {
  font-size: 0.8rem; color: var(--sub); text-align: center;
  margin: 0.25rem 0 0.5rem; font-style: italic;
}

/* Prescription box */
.ex-box {
  margin-top: 1rem; padding: 0.875rem 1rem;
  background: var(--exbox-bg); border-radius: 8px;
  border: 1px solid var(--border);
}
.ex-rx {
  font-family: var(--font-heading); font-size: 0.88rem; font-weight: 600;
  color: var(--heading2); line-height: 1.6;
}
.ex-video {
  margin-top: 0.5rem; font-size: 0.8rem;
}
.ex-video a {
  color: var(--accent); text-decoration: none;
  display: inline-flex; align-items: center; gap: 6px;
  font-weight: 500; transition: opacity 0.15s;
}
.ex-video a:hover { opacity: 0.8; }
.ex-video a::before {
  content: '▶'; font-size: 0.65rem;
}
.ex-video-none { color: var(--sub); font-size: 0.8rem; margin-top: 0.5rem; }

/* Graduation box */
.grad-box {
  border: 2px solid var(--accent);
  padding: 1rem 1.25rem; margin: 1.25rem 0;
  display: flex; gap: 12px; align-items: flex-start;
  border-radius: 8px; background: var(--accent-soft);
}
.grad-check { font-size: 1.25rem; color: var(--accent); flex-shrink: 0; }
.grad-text {
  font-family: var(--font-heading); font-size: 0.9rem; font-weight: 600;
  color: var(--heading2); line-height: 1.5;
}

/* Callout */
.callout {
  font-style: italic; color: var(--heading2);
  padding: 1rem 1.25rem; margin: 1.5rem 0;
  background: var(--accent-soft); border-radius: 8px;
  border-left: 3px solid var(--accent);
}

/* Benchmarking table */
.bench-table {
  width: 100%; border-collapse: collapse; margin: 1rem 0;
  font-size: 0.9rem; border-radius: 8px; overflow: hidden;
}
.bench-table th {
  background: var(--table-header-bg); color: var(--table-header-text);
  font-family: var(--font-heading); font-weight: 600;
  padding: 0.75rem 1rem; text-align: left;
}
.bench-table th:first-child { text-align: center; width: 60px; }
.bench-table td {
  padding: 0.75rem 1rem; border-bottom: 1px solid var(--border);
  color: var(--text); vertical-align: top;
}
.bench-table td:first-child {
  text-align: center; font-family: var(--font-heading);
  font-weight: 700; color: var(--accent);
}

/* Block heading */
.block-heading {
  font-family: var(--font-heading); font-size: 0.95rem; font-weight: 700;
  color: var(--accent); margin: 1.5rem 0 0.25rem;
}

/* Closing section */
.closing {
  text-align: center; padding: 3rem 0 1rem;
}
.closing .cl-main {
  font-family: var(--font-heading); font-weight: 700; font-size: 1.25rem;
  color: var(--heading);
}
.closing .cl-sub {
  font-style: italic; color: var(--sub); margin-top: 0.5rem;
}

/* Title page */
.title-page {
  display: flex; flex-direction: column; justify-content: center;
  align-items: center; min-height: 50vh; text-align: center;
  padding: 3rem 2rem;
}
.title-page h1 {
  font-family: var(--font-heading); font-size: 2rem; font-weight: 800;
  color: var(--heading); margin-bottom: 0.5rem;
}
.title-page .accent-rule { width: 60px; height: 2px; background: var(--accent); margin: 0.5rem auto; }
.title-page .subtitle { font-family: var(--font-heading); font-size: 1.05rem; font-weight: 600; color: var(--accent); }
.title-page .tagline { font-size: 0.9rem; color: var(--sub); margin-top: 0.25rem; }
.title-page .author { font-family: var(--font-heading); font-weight: 600; font-size: 0.95rem; color: var(--text); margin-top: 3rem; }
.title-page .edition { font-size: 0.85rem; color: var(--sub); margin-top: 0.25rem; }

/* Disclaimer */
.disclaimer { padding: 2rem 0; }
.disclaimer h2 { font-family: var(--font-heading); color: var(--sub); font-size: 1.1rem; font-weight: 700; margin-bottom: 0.5rem; }
.disclaimer-rule { width: 100%; height: 1px; background: var(--border); margin-bottom: 1rem; }
.disclaimer p { font-size: 0.88rem; color: var(--sub); line-height: 1.6; margin-bottom: 0.75rem; }
.copyright { text-align: center; margin-top: 2rem; }
.copyright p { font-size: 0.75rem; color: var(--sub); margin-bottom: 0.25rem; }

/* In-content TOC */
.book-toc .toc-accent { width: 40px; height: 3px; background: var(--accent); border-radius: 2px; margin-bottom: 1.25rem; }
.book-toc .toc-item {
  padding: 0.4rem 0; font-size: 0.95rem; color: var(--text);
  cursor: pointer; transition: color 0.15s;
}
.book-toc .toc-item:hover { color: var(--accent); }
.book-toc .toc-sub { padding-left: 1.25rem; color: var(--sub); }

/* Accent HR */
.accent-hr { border: none; height: 2px; background: var(--accent); margin: 2rem 0; border-radius: 1px; }

/* Helper classes */
.text-small { font-size: 0.88rem; }
.text-sub { color: var(--sub); }

/* Back to top */
#back-to-top {
  position: fixed; bottom: 24px; right: 24px; z-index: 90;
  width: 44px; height: 44px; border-radius: 50%;
  background: var(--chrome-accent); color: #0a0a0a;
  border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  opacity: 0; transform: translateY(12px);
  transition: opacity 0.3s, transform 0.3s;
  pointer-events: none;
}
#back-to-top.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
#back-to-top:hover { background: #d4b76a; }
#back-to-top svg {
  width: 20px; height: 20px; stroke: currentColor; fill: none;
  stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round;
}

/* ===== SETTINGS PANEL ===== */
.dropdown-panel {
  position: fixed; top: 60px; right: 16px;
  background: var(--chrome-bg); border: 1px solid var(--chrome-border);
  border-radius: 12px; padding: 20px; z-index: 300;
  min-width: 260px; box-shadow: 0 12px 40px rgba(0,0,0,0.5);
  transform: translateY(-8px); opacity: 0; pointer-events: none;
  transition: transform 0.2s, opacity 0.2s;
}
.dropdown-panel.open { transform: translateY(0); opacity: 1; pointer-events: auto; }

.panel-section { margin-bottom: 16px; }
.panel-section:last-child { margin-bottom: 0; }
.panel-label {
  font-family: var(--font-heading); font-size: 0.65rem; font-weight: 700;
  color: var(--chrome-dim); text-transform: uppercase;
  letter-spacing: 0.12em; margin-bottom: 10px;
}

/* Font size controls */
.font-size-row { display: flex; align-items: center; gap: 12px; }
.font-btn {
  width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
  border: 1px solid rgba(255,255,255,0.1); background: transparent;
  cursor: pointer; border-radius: 8px; color: var(--chrome-text);
  font-family: var(--font-heading); font-size: 0.95rem; font-weight: 700;
  transition: background 0.15s;
}
.font-btn:hover { background: var(--chrome-hover); }
.font-size-display {
  flex: 1; text-align: center; font-family: var(--font-body);
  font-size: 0.88rem; color: var(--chrome-text); font-variant-numeric: tabular-nums;
}

/* Theme buttons */
.theme-row { display: flex; gap: 8px; }
.theme-btn {
  flex: 1; height: 38px; border: 2px solid rgba(255,255,255,0.1);
  border-radius: 8px; cursor: pointer;
  font-family: var(--font-heading); font-size: 0.75rem; font-weight: 600;
  transition: border-color 0.15s, transform 0.1s;
}
.theme-btn:hover { transform: scale(1.03); }
.theme-btn.active { border-color: var(--chrome-accent); box-shadow: 0 0 0 1px var(--chrome-accent); }
.theme-btn-light { background: #fff; color: #1a1a2e; }
.theme-btn-sepia { background: #f8f1e3; color: #5b4636; }
.theme-btn-dark { background: #16162a; color: #e2e8f0; }

/* ===== DOWNLOAD PANEL ===== */
.dl-btn {
  display: flex; align-items: center; gap: 12px; width: 100%;
  padding: 12px 14px; border: 1px solid rgba(255,255,255,0.08);
  background: transparent; border-radius: 10px; cursor: pointer;
  margin-bottom: 8px; transition: background 0.15s;
  text-align: left; color: var(--chrome-text);
}
.dl-btn:last-of-type { margin-bottom: 0; }
.dl-btn:hover { background: var(--chrome-hover); }
.dl-icon {
  width: 40px; height: 40px; border-radius: 8px;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.dl-icon.pdf { background: rgba(239,68,68,0.15); }
.dl-icon.pdf svg { stroke: #ef4444; }
.dl-icon.epub { background: rgba(34,197,94,0.15); }
.dl-icon.epub svg { stroke: #22c55e; }
.dl-icon svg { width: 20px; height: 20px; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
.dl-btn-text { flex: 1; }
.dl-btn-title { font-family: var(--font-heading); font-size: 0.88rem; font-weight: 700; color: var(--chrome-text); }
.dl-btn-hint { font-size: 0.7rem; color: var(--chrome-dim); margin-top: 2px; }

/* ===== TOAST ===== */
#toast {
  position: fixed; bottom: 32px; left: 50%; transform: translateX(-50%) translateY(20px);
  background: #1a1a1a; color: #f0ede8; padding: 12px 24px;
  border-radius: 10px; font-size: 0.88rem; font-family: var(--font-body);
  box-shadow: 0 8px 30px rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.08);
  opacity: 0; pointer-events: none; z-index: 500;
  transition: opacity 0.3s, transform 0.3s;
}
#toast.visible { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ===== RESPONSIVE ===== */
@media (max-width: 900px) {
  #toc-sidebar {
    position: fixed; top: 0; left: 0; bottom: 0;
    z-index: 200; width: 300px; max-width: 85vw;
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin-left: 0 !important;
    border-right: none;
  }
  #toc-sidebar.mobile-open { transform: translateX(0); }
  #toc-overlay { display: block; }
  #toc-overlay.visible { pointer-events: auto; }

  .chapter-content { padding: 1.75rem 1.5rem 2rem; }
  .chapter-opener { padding: 1.5rem 1.5rem; }
  .exercise-sequence-3 { grid-template-columns: 1fr 1fr; }
  .exercise-sequence-5 { grid-template-columns: 1fr 1fr; }
  .cover-hero { min-height: 60vh; }
}

@media (max-width: 480px) {
  .chapter-content { padding: 1.25rem 1rem 1.5rem; }
  .chapter-opener { padding: 1.25rem 1rem; }
  .chapter-opener h1 { font-size: 1.4rem; }
  .exercise-block { padding: 1rem; }
  .exercise-sequence-2,
  .exercise-sequence-3,
  .exercise-sequence-4,
  .exercise-sequence-5 { grid-template-columns: 1fr 1fr; }
  .exercise-sequence-3 img:last-child:nth-child(odd) {
    grid-column: 1 / -1; max-width: 60%; margin: 0 auto;
  }
}

/* ===== PRINT — A4 book pagination ===== */
@media print {
  /* Hide all reader chrome */
  #toolbar, #toc-sidebar, #toc-overlay, #progress-bar,
  #settings-panel, #download-panel, #back-to-top,
  #auth-gate, #toast { display: none !important; }

  /* Reset layout to normal document flow */
  html, body {
    overflow: visible !important; height: auto !important;
    background: white !important; color: #222 !important;
    font-size: 11pt !important; line-height: 1.55 !important;
  }
  #reader { display: block !important; height: auto !important; overflow: visible !important; width: auto !important; }
  #reader-body { display: block !important; overflow: visible !important; height: auto !important; }
  #content-area { overflow: visible !important; height: auto !important; background: white !important; }
  .book-section { border-bottom: none !important; }

  /* A4 page setup */
  @page { size: A4; margin: 2.2cm 2cm 2.5cm 2cm; }
  @page :first { margin: 0; }

  /* ---- Cover page ---- */
  #cover { page-break-after: always; }
  .cover-hero {
    min-height: 0 !important; padding: 6cm 2cm 3cm !important;
    background: transparent !important;
  }
  .cover-hero > img, .cover-overlay { display: none !important; }
  .cover-content { position: static !important; }
  .cover-label { color: #000 !important; font-size: 12pt !important; }
  .cover-title { color: #000 !important; font-size: 30pt !important; }
  .cover-divider {
    background: #000 !important; height: 3px !important; width: 80px !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }
  .cover-subtitle { color: #444 !important; font-size: 13pt !important; }
  .cover-tagline { color: #777 !important; }
  .cover-brand span { color: #444 !important; }
  .cover-brand-line {
    background: #000 !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }

  /* ---- Frontmatter ---- */
  #frontmatter { page-break-after: always; }
  .title-page { min-height: auto !important; padding: 4cm 0 2cm !important; page-break-after: always; }
  .title-page h1 { color: #000 !important; font-size: 24pt !important; }
  .title-page .accent-rule {
    background: #000 !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }
  .title-page .subtitle { color: #444 !important; }
  .title-page .tagline { color: #777 !important; }
  .title-page .author { color: #222 !important; }
  .title-page .edition { color: #777 !important; }
  .disclaimer h2 { color: #555 !important; }
  .disclaimer p { color: #555 !important; }

  /* ---- Chapter openers ---- */
  .chapter-opener {
    page-break-before: always;
    background: transparent !important;
    border-bottom: 3px solid #222 !important;
    padding: 1.5cm 0 0.8cm !important;
    margin: 0 !important;
  }
  .chapter-opener h1 { color: #000 !important; font-size: 22pt !important; }
  .chapter-opener .ch-accent {
    background: #222 !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }
  .chapter-opener .ch-subtitle { color: #555 !important; }
  #frontmatter .chapter-opener { display: none !important; }

  /* ---- Chapter content ---- */
  .chapter-content {
    max-width: none !important; padding: 0.8cm 0 1cm !important;
    font-size: 11pt !important;
  }
  .chapter-content p { color: #333 !important; }
  .chapter-content h2, .chapter-content .section-title { color: #111 !important; font-size: 14pt !important; }
  .chapter-content h3, .chapter-content .block-heading { color: #444 !important; font-size: 12pt !important; }
  .chapter-content strong, .chapter-content b { color: #111 !important; }
  .chapter-content a { color: #333 !important; text-decoration: underline !important; }
  .ex-video a::before { content: '' !important; }

  /* ---- Level intro ---- */
  .level-intro {
    background: #f5f5f5 !important; border-left: 3px solid #999 !important;
    color: #444 !important; border-radius: 0 !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }

  /* ---- Exercise blocks ---- */
  .exercise-block {
    break-inside: avoid !important; page-break-inside: avoid !important;
    border: 1px solid #ccc !important; border-radius: 0 !important;
    box-shadow: none !important; margin: 1cm 0 !important;
  }
  .exercise-block h3 { color: #444 !important; }

  /* ---- Prescription boxes ---- */
  .ex-box {
    background: #f5f5f5 !important; border: 1px solid #ddd !important;
    border-radius: 0 !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }
  .ex-rx { color: #222 !important; }

  /* ---- Images ---- */
  .exercise-img, .exercise-sequence {
    break-inside: avoid !important; page-break-inside: avoid !important;
  }
  .exercise-img img, .exercise-sequence img { max-height: 8cm !important; }
  .exercise-img-tall { max-width: 5cm !important; }

  /* ---- Table ---- */
  .bench-table {
    break-inside: avoid !important; page-break-inside: avoid !important;
  }
  .bench-table th {
    background: #333 !important; color: #fff !important;
    -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important;
  }
  .bench-table td { color: #333 !important; }
  .bench-table td:first-child { color: #333 !important; font-weight: 700 !important; }

  /* ---- Callout ---- */
  .callout {
    background: #f5f5f5 !important; border-left: 3px solid #999 !important;
    color: #333 !important; border-radius: 0 !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }

  /* ---- Graduation box ---- */
  .grad-box {
    break-inside: avoid !important;
    border: 2px solid #444 !important; border-radius: 0 !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }

  /* ---- Accent HR ---- */
  .accent-hr {
    background: #444 !important;
    -webkit-print-color-adjust: exact; print-color-adjust: exact;
  }

  /* ---- Closing ---- */
  .closing { padding-top: 3cm !important; }
  .closing .cl-main { color: #000 !important; }
  .closing .cl-sub { color: #555 !important; }
}
</style>
</head>
<body>

<!-- ============================================================
     AUTH GATE
     ============================================================ -->
<div id="auth-gate">
  <div class="gate-spinner" id="gate-spinner"></div>
  <div class="gate-icon" id="gate-icon" style="display:none;">
    <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
  </div>
  <div class="gate-title" id="gate-title">Verifying Purchase…</div>
  <div class="gate-message" id="gate-message">Please wait while we verify your access.</div>
  <a href="/" class="gate-btn" id="gate-btn" style="display:none;">Purchase the Guide</a>
</div>

<!-- ============================================================
     READER
     ============================================================ -->
<div id="reader">

  <!-- Progress Bar -->
  <div id="progress-bar"><div id="progress-fill"></div></div>

  <!-- Toolbar -->
  <header id="toolbar">
    <div class="toolbar-left">
      <button class="tb-btn" id="btn-toc" aria-label="Table of Contents">
        <svg viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="toolbar-title-area">
      <span class="toolbar-chapter" id="toolbar-chapter">The Ring Muscle Up</span>
      <span class="toolbar-sub" id="toolbar-sub">The Complete Training Guide</span>
    </div>
    <div class="toolbar-right">
      <button class="tb-btn" id="btn-settings" aria-label="Settings">
        <svg viewBox="0 0 24 24"><text x="4" y="17" font-size="15" font-family="Plus Jakarta Sans, sans-serif" font-weight="700" fill="currentColor" stroke="none">Aa</text></svg>
      </button>
      <button class="tb-btn" id="btn-download" aria-label="Download">
        <svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      </button>
    </div>
  </header>

  <!-- Settings Panel -->
  <div class="dropdown-panel" id="settings-panel">
    <div class="panel-section">
      <div class="panel-label">Font Size</div>
      <div class="font-size-row">
        <button class="font-btn" id="font-decrease">A−</button>
        <div class="font-size-display" id="font-size-display">100%</div>
        <button class="font-btn" id="font-increase">A+</button>
      </div>
    </div>
    <div class="panel-section">
      <div class="panel-label">Theme</div>
      <div class="theme-row">
        <button class="theme-btn theme-btn-light active" data-theme="light">Light</button>
        <button class="theme-btn theme-btn-sepia" data-theme="sepia">Sepia</button>
        <button class="theme-btn theme-btn-dark" data-theme="dark">Dark</button>
      </div>
    </div>
  </div>

  <!-- Download Panel -->
  <div class="dropdown-panel" id="download-panel">
    <div class="panel-section">
      <div class="panel-label">Download</div>
      <button class="dl-btn" id="dl-pdf">
        <div class="dl-icon pdf">
          <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        </div>
        <div class="dl-btn-text">
          <div class="dl-btn-title">Download PDF</div>
          <div class="dl-btn-hint">Best for printing (A4 format)</div>
        </div>
      </button>
      <button class="dl-btn" id="dl-epub">
        <div class="dl-icon epub">
          <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
        </div>
        <div class="dl-btn-text">
          <div class="dl-btn-title">Download ePub</div>
          <div class="dl-btn-hint">For Apple Books, Kindle, Kobo</div>
        </div>
      </button>
    </div>
  </div>

  <!-- Reader Body -->
  <div id="reader-body">

    <!-- TOC Overlay (mobile) -->
    <div id="toc-overlay"></div>

    <!-- TOC Sidebar -->
    <aside id="toc-sidebar">
      <div class="toc-header"><h2>Contents</h2></div>
      <nav class="toc-nav" id="toc-nav">
        <a href="#cover" class="toc-link active" data-section="cover">Cover</a>
        <a href="#frontmatter" class="toc-link" data-section="frontmatter">Title &amp; Disclaimer</a>
        <a href="#introduction" class="toc-link" data-section="introduction">Introduction</a>
        <a href="#benchmarking" class="toc-link" data-section="benchmarking">Benchmarking</a>
        <a href="#loading" class="toc-link" data-section="loading">Loading &amp; Deloading</a>
        <a href="#workouts" class="toc-link" data-section="workouts">The Workouts</a>
        <a href="#level-1" class="toc-link toc-link-sub" data-section="level-1"><span class="toc-num">01</span> Level 1 — Foundation</a>
        <a href="#level-2" class="toc-link toc-link-sub" data-section="level-2"><span class="toc-num">02</span> Level 2 — Pull &amp; Push</a>
        <a href="#level-3" class="toc-link toc-link-sub" data-section="level-3"><span class="toc-num">03</span> Level 3 — False Grip</a>
        <a href="#level-4" class="toc-link toc-link-sub" data-section="level-4"><span class="toc-num">04</span> Level 4 — Eccentric</a>
        <a href="#level-5" class="toc-link toc-link-sub" data-section="level-5"><span class="toc-num">05</span> Level 5 — First MU</a>
        <a href="#level-6" class="toc-link toc-link-sub" data-section="level-6"><span class="toc-num">06</span> Level 6 — Conditioning</a>
      </nav>
    </aside>

    <!-- Content Area -->
    <main id="content-area">

<!-- ============================================================
     COVER
     ============================================================ -->
<section id="cover" class="book-section">
  <div class="cover-hero">
    <img src="assets/images/coverpage.png" alt="">
    <div class="cover-overlay"></div>
    <div class="cover-content">
      <span class="cover-label">THE</span>
      <div class="cover-title">RING MUSCLE UP</div>
      <div class="cover-divider"></div>
      <div class="cover-subtitle">The Complete Training Guide</div>
      <div class="cover-tagline">From Your First Ring Hang to a Clean, Strict Muscle Up</div>
      <div class="cover-brand">
        <div class="cover-brand-line"></div>
        <span>The Bodyweight Gym</span>
      </div>
    </div>
  </div>
</section>

<!-- ============================================================
     FRONTMATTER (title + disclaimer)
     ============================================================ -->
<section id="frontmatter" class="book-section">
  <div class="chapter-content">
    <div class="title-page">
      <h1>THE RING MUSCLE UP</h1>
      <div class="accent-rule"></div>
      <div class="subtitle">The Complete Training Guide</div>
      <div class="tagline">From Your First Ring Hang to a Clean, Strict Muscle Up</div>
      <div class="author">The Bodyweight Gym</div>
      <div class="edition">Version 1</div>
    </div>
    <hr class="accent-hr">
    <div class="disclaimer">
      <h2>Disclaimer</h2>
      <div class="disclaimer-rule"></div>
      <p>Before starting any exercise program, you should consider consulting a qualified fitness or sports adviser to ensure the program is suitable for you. Do not undertake training with The Bodyweight Gym without professional or qualified instruction on proper uses and appropriate techniques. Use common sense when training and understand your personal limitations.</p>
      <p>Any program involving resistance training, gymnastics training and/or activities at height is potentially dangerous and could lead to severe injury or death. The user assumes all risks and responsibilities for injuries or death which may occur during or following use of this equipment in any manner whatsoever. The Bodyweight Gym cannot be held responsible for any injuries which may occur as a result of training with this program or the associated equipment.</p>
      <p>The Bodyweight Gym and buyer disclaim any express or implied warranty, including, but not limited to, warranties of merchantability or fitness for a particular purpose. Buyer assumes all liability in use of this program.</p>
      <p>The Bodyweight Gym advocates the learning of skills with strict movements.</p>
      <div class="copyright">
        <p>© The Bodyweight Gym. All rights reserved.</p>
        <p>No part of this publication may be reproduced without written permission.</p>
      </div>
    </div>
  </div>
</section>

<!-- ============================================================
     INTRODUCTION
     ============================================================ -->
<section id="introduction" class="book-section">
  <div class="chapter-opener">
    <h1>Introduction</h1>
  </div>
  <div class="chapter-content">
    <div class="exercise-img exercise-img-wide">
      <img src="assets/images/coverpage.png" alt="The Ring Muscle Up — The Complete Training Guide">
    </div>

    <p>The ring muscle up is an exercise that involves moving from below a set of rings to the support position above a set of rings. In the sport of gymnastics it's called getting on the rings and isn't even a thing. For many fitness enthusiasts the ring muscle up is a highly sought-after expression of strength and mobility.</p>

    <p>Often the ring muscle up is referred to as a skill. I prefer to think of the ring muscle up as an expression of strength and mobility. Skill exercises are difficult to develop and often require elements that are harder to train, such as balance or novel movement (e.g. press handstand). The ring muscle up contains neither of these things. It is easy to learn with a solid series of progressions, hard work and persistence.</p>

    <p>This guide will break down your ring muscle up progression into 6 different levels. Each level will have a graduation testing requirement. In order to progress smoothly, I strongly recommend that you satisfy each graduation test before progressing to the next level.</p>

    <p>For many people the ring muscle up presents both a mobility and strength challenge. If you are reading this guide it is likely that you will have to get stronger and develop more mobility to complete a ring muscle up.</p>

    <p>For the sake of clarity, by referring to a ring muscle up I mean a strict ring muscle up, with minimal pike in the hips and no momentum generated by swinging or kipping.</p>

    <p>The most common question I hear is — "How long will it take?" This is impossible to answer; it depends entirely on your current and historic strength and mobility level. If you learn to use the gymnastic rings as a child you will redevelop the movement faster than an adult with limited or no exposure to this kind of upper body strength training.</p>

    <p>The ring muscle up demands strength, and is expressed through the entire upper body chain. It requires the back, shoulders, upper and lower arms to function together. If you have spent time training these muscles in isolation you may need to step back and assess and strengthen any weak links in the chain. It is likely that your shoulder and elbow joints and the associated connective tissue will need to strengthen and improve.</p>

    <p>The goal of training for the ring muscle up (and all strength training) is to stress your body such that you can recover within a few days, then do it again. If you stress your body too much this is called an injury. Injuries may occur if you train for long enough, but with an appreciation for strength training basics you can minimize the risk of injury. You can only progress as fast as the weakest link in the chain you are aiming to strengthen.</p>

    <h2 class="section-title">Soft tissue adaptation</h2>

    <p>Muscles replace themselves approximately every 3 months. Tendons and ligaments replace themselves approximately every 9 months and bone replaces itself every 14–15 months. So if you are getting strong and your elbows are killing you — slow down. Your elbow joint can't keep up with the rate of progress.</p>

    <p>Training for your ring muscle up should be no more than once every 2 days. Give yourself time to recover between efforts. If you are training intensely or very regularly take a planned deload week every 5 weeks. In a deload week you will still train however you will only complete 1 set of everything rather than the usual volume.</p>
  </div>
</section>

<!-- ============================================================
     BENCHMARKING
     ============================================================ -->
<section id="benchmarking" class="book-section">
  <div class="chapter-opener">
    <h1>Benchmarking</h1>
  </div>
  <div class="chapter-content">
    <p>If you are completely new to training upper body strength you will begin at Level 1. However if you have some experience in training upper body strength you will first need to figure out what level is appropriate to you. Use this benchmarking test to find an appropriate level:</p>

    <table class="bench-table">
      <thead>
        <tr><th>Level</th><th>Entry Requirements</th></tr>
      </thead>
      <tbody>
        <tr><td>1</td><td>Zero experience or unsure.</td></tr>
        <tr><td>2</td><td>3 × pull ups, 3 × bar dips.</td></tr>
        <tr><td>3</td><td>Experience with false grip, 3 × false grip pull ups, 3 × ring dips.</td></tr>
        <tr><td>4</td><td>Reasonably comfortable with false grip, 5 × false grip pull ups, 5 × ring dips.</td></tr>
        <tr><td>5</td><td>Can do a ring muscle up but want to clean it up.</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- ============================================================
     LOADING, DELOADING
     ============================================================ -->
<section id="loading" class="book-section">
  <div class="chapter-opener">
    <h1>Loading, Deloading</h1>
    <div class="ch-accent"></div>
    <div class="ch-subtitle">and How to Progress</div>
  </div>
  <div class="chapter-content">
    <p>Your training should be planned and arranged in blocks of effort. The following is an example of how you can train and recover such that you give your body enough stress to grow and enough time to recover.</p>

    <h3 class="block-heading">Block 1</h3>
    <p>Pick a level and a set range that is appropriate to your current strength and endurance. If in doubt be more conservative. An injury is the worst outcome. Work hard for 4 weeks. Take the 5th week off as stated above.</p>

    <h3 class="block-heading">Block 2</h3>
    <p>Add a set to each exercise you completed in block 1. Work hard for 4 weeks. Take the 5th week off. Repeat this process of loading, deloading and adding volume until you have reached the upper set range prescribed for your workout.</p>

    <h3 class="block-heading">Block 3</h3>
    <p>Test yourself for the next level entry requirements (refer Benchmarking section). If you are now capable of the next level, begin the process again with the next level of exercise, slowly increasing volume over 5 week cycles.</p>

    <h3 class="block-heading">Block 4</h3>
    <p>Continue developing your training program based on your progress.</p>

    <p class="callout">Remember: Learning a muscle up from scratch may take more than 12 months, so patience is key.</p>
  </div>
</section>

<!-- ============================================================
     THE WORKOUTS INTRO
     ============================================================ -->
<section id="workouts" class="book-section">
  <div class="chapter-opener">
    <h1>The Workouts</h1>
  </div>
  <div class="chapter-content">
    <p>This workout program offers 6 different levels in order to safely progress you from the beginning to a clean, safe, strict ring muscle up. Each level requires you to possess greater strength and mobility. Be conservative and start with a level that is achievable. If you find you are not progressing at a particular level, drop back to the previous level for 1 block of training before moving forward again.</p>
    <p>Before each workout, be sure to warm yourself up adequately. 5–10 minutes of any light cardio, running or skipping etc of your choice. Anything to get a light sweat on.</p>
  </div>
</section>

<!-- ============================================================
     LEVEL 1
     ============================================================ -->
<section id="level-1" class="book-section">
  <div class="chapter-opener">
    <h1>Level 1</h1>
    <div class="ch-accent"></div>
    <div class="ch-subtitle">Foundation</div>
  </div>
  <div class="chapter-content">
    <p class="level-intro">As a level 1 athlete you are right at the beginning of developing bent arm strength. This is something that should not be rushed. Everyone will progress at their own rate. Do the work necessary to make this level feel easy before progressing to level 2. This workout is all about developing wrist strength and mobility, shoulder extension and basic pushing and pulling strength.</p>

    <h2 class="section-title">Mobility work</h2>

    <div class="exercise-block">
      <h3>False grip stretch</h3>
      <div class="exercise-img">
        <img src="assets/images/fgringstretch.png" alt="False grip stretch on rings">
      </div>
      <p>False grip requires flexibility through the back of the forearm (extensors) and strength through the inside of the forearm (for gripping). This mobility exercise will develop the required strength and mobility to become comfortable in false grip.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 10, hold last rep (HLR) 10 seconds<br>Sets: 3–5</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=fPrirk5JELI" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>Arm extension stretch</h3>
      <div class="exercise-img">
        <img src="assets/images/armExtensionStretch.png" alt="Arm extension stretch">
      </div>
      <p>The transition phase of a muscle up, moving from the top of the pull up to the bottom of the dip, requires the upper arms to move strongly into extension. For many people this range of motion is lacking. This stretch will build the required mobility to stay safe while practicing ring muscle ups.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 5 per side, HLR per side 10 seconds<br>Sets: 3–5</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=85yAKJCn5sg" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <h2 class="section-title">Strength work</h2>

    <div class="exercise-block">
      <h3>Ring hang</h3>
      <div class="exercise-img exercise-img-tall">
        <img src="assets/images/ringhang.png" alt="Ring hang">
      </div>
      <p>Hanging is the fundamental strength expression needed to build more powerful movements such as pull ups and eventually muscle ups. While simple, even the shortest periods of time hanging from a set of rings will challenge most people. Keep this one simple. Hold the rings, feet off the ground, don't let go.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: 1 minute hang<br>Sets: Complete 3–5 sets of false grip stretch, arm extension stretch and ring hang</div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>False grip</h3>
      <div class="exercise-img exercise-img-tall">
        <img src="assets/images/fgringhang.png" alt="False grip on rings">
      </div>
      <p>False grip is a method of holding the rings (or bar) that places your wrist on top of the ring. It requires your wrist to bend at 90 degrees while still being able to grip the ring with your fingers. Yes it hurts your wrists. They will toughen. It takes a long time to become comfortable with false grip. Take your time. Chalking the heel of the hand and wrist where primary contact is made with the rings will make it easier.</p>
      <div class="ex-box">
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=C1tIcRAsKLc" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>False grip ring rows</h3>
      <p class="exercise-sequence-caption">Start (lean back) → Middle (thumbs to chest)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/ringrowtransistionbottom.png" alt="False grip ring row — start, arms extended">
        <img src="assets/images/ringrowtransitionmiddle.png" alt="False grip ring row — middle, thumbs to chest">
      </div>
      <p>Hold the rings in false grip, lean back holding the rings at arm's length. Maintain false grip. Row the rings in towards your body pulling until your thumbs touch your chest. Return to the straight arm position slowly. If you find it too hard to complete all the reps walk backwards to reduce the resistance.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 15<br>Sets: Complete 3–5 sets of 15 × false grip ring rows and 15 × ring push ups</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=wC5LeDNJ1ro" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>Ring push ups with turn out</h3>
      <p class="exercise-sequence-caption">Bottom (ring to shoulder) → Top (lockout, then turn out)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/ringpushupbottom.png" alt="Ring push up — bottom, ring to shoulder">
        <img src="assets/images/ringpushuptop.png" alt="Ring push up — top, turn out">
      </div>
      <p>Hold yourself in a plank position supported on the rings in front of you. Keeping your elbows in tight, lower down to the bottom position until the ring touches your shoulder. Push back up to the beginning position and externally rotate the rings for a moment.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 15</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=rLTVcV6KlQ8" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>
  </div>
</section>

<!-- ============================================================
     LEVEL 2
     ============================================================ -->
<section id="level-2" class="book-section">
  <div class="chapter-opener">
    <h1>Level 2</h1>
    <div class="ch-accent"></div>
    <div class="ch-subtitle">Pull &amp; Push</div>
  </div>
  <div class="chapter-content">
    <p class="level-intro">As a level 2 athlete you now have some strength in bent arm pulling and pushing. You should feel comfortable performing a pull up or a dip. As you progress your strength pay attention to how your shoulders and elbows feel. If they begin to hurt or feel less than great, consider dropping back to level 1 to build a larger foundation.</p>

    <h2 class="section-title">Mobility work</h2>
    <p class="text-small">Continue <b>False grip stretch</b> (× 10 HLR 10 sec) and <b>Arm extension stretch</b> (× 5 per side HLR 10 sec) as in Level 1.</p>

    <h2 class="section-title">Strength work</h2>

    <div class="exercise-block">
      <h3>False grip hang</h3>
      <div class="exercise-img exercise-img-tall">
        <img src="assets/images/fgringhang.png" alt="False grip hang">
      </div>
      <p>This takes the hang as practiced in level one and builds on it by adding false grip. Maintaining false grip is your priority; hang from a set of rings for the prescribed period of time.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 30 seconds<br>Sets: Complete 3–5 sets of false grip stretch, arm extension stretch and false grip hang</div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>Transition ring rows</h3>
      <p class="exercise-sequence-caption">Start (lean back) → Middle (row to chest) → End (rings to armpits, support)</p>
      <div class="exercise-sequence exercise-sequence-3">
        <img src="assets/images/ringrowtransistionbottom.png" alt="Transition ring row — start, straight arms">
        <img src="assets/images/ringrowtransitionmiddle.png" alt="Transition ring row — middle, thumb to chest">
        <img src="assets/images/ringrowtransitiontop.png" alt="Transition ring row — end, rings in armpits">
      </div>
      <p>This variation of the ring row begins as a false grip ring row and incorporates the transition movement at the top of the row. Begin the movement leaning back holding the rings with straight arms. Row the rings into your body until your thumb touches your chest. At this point drop your hips aggressively at the same time pulling the rings across your chest and into your armpits. Catch your balance with the rings supporting your weight. Reverse this process till you are in the beginning position to complete the movement.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 8<br>Sets: Complete 3–5 sets of transition ring rows</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=poBkFVAesrE" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>Pull up</h3>
      <p class="exercise-sequence-caption">Start (dead hang) → Middle (scap set) → End (chin over rings)</p>
      <div class="exercise-sequence exercise-sequence-3">
        <img src="assets/images/ringpullupbottom.png" alt="Pull up — start, dead hang">
        <img src="assets/images/ringpullupscapdownmiddle.png" alt="Pull up — middle, shoulders down and back">
        <img src="assets/images/ringpulluptop.png" alt="Pull up — end, chin over rings">
      </div>
      <p>Holding the rings (or bar) from below, using a normal grip complete a pull up. Begin from a dead hang, depress and retract your shoulder blades (pull your shoulders down). Then bend your elbows pulling your chin over the rings. Return to a dead hang slowly in control to complete the repetition.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 5 reps</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=J1tA_KvAa6o" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>Bar dip</h3>
      <p class="exercise-sequence-caption">Bottom (dip down) → Top (support, lockout)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/bardipbottom.png" alt="Bar dip — bottom position">
        <img src="assets/images/bardiptop.png" alt="Bar dip — top, support position">
      </div>
      <p>Using a set of parallel bars, complete bar dips. Begin in a support position with your shoulders depressed (keep your shoulders away from your ears); dip down as low as you can control before pressing back into support position.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 5 reps<br>Sets: Complete 3 sets of pull ups and bar dips</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=Cc42gTpLIms" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>
  </div>
</section>

<!-- ============================================================
     LEVEL 3
     ============================================================ -->
<section id="level-3" class="book-section">
  <div class="chapter-opener">
    <h1>Level 3</h1>
    <div class="ch-accent"></div>
    <div class="ch-subtitle">False Grip Integration</div>
  </div>
  <div class="chapter-content">
    <p class="level-intro">As a level 3 athlete you should feel very comfortable with normal pull ups and dips using rings and bars. As you progress to integrating your false grip into higher power expressions of pulling and pushing pay attention to how your wrists and elbows feel. The skin on your wrists will take a beating; you can tolerate this. However if the joints are beginning to hurt or feel less than great, consider spending more time at level 2.</p>

    <h2 class="section-title">Mobility work</h2>
    <p class="text-small">Continue <b>False grip stretch</b> and <b>Arm extension stretch</b> as in Level 1.</p>

    <h2 class="section-title">Strength work</h2>

    <div class="exercise-block">
      <h3>False grip pull ups</h3>
      <p class="exercise-sequence-caption">Start (false grip hang) → End (thumbs to chest)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/fgringhang.png" alt="False grip pull up — start, false grip hang">
        <img src="assets/images/fgpulluptop.png" alt="False grip pull up — end, thumbs to chest">
      </div>
      <p>Begin the false grip pull up from a false grip hang. Initiate the movement by pulling your shoulders down and back before bending your elbows and pulling yourself up. Continue until your thumbs touch your chest. This range of motion is very important as it sets up the position to complete the transition.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 5<br>Sets: Complete 3–5 sets of 5 × false grip pull ups and 5 × ring dips</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=5R07lItt9EY" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>Ring dips with turn out</h3>
      <p class="exercise-sequence-caption">Top (support, rings turned out) → Bottom (rings to shoulder)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/rgmuscledowntop.png" alt="Ring dip — top, support, rings turned out">
        <img src="assets/images/rgmuscledownbottomdip.png" alt="Ring dip — bottom, rings to shoulder">
      </div>
      <p>Begin in support position above the rings with the rings turned out (palms facing forward). As a beginner, make sure you keep the rings very close to your body. The further away from you they move the harder you will have to work. Turn the rings back to parallel and lower down through the dip. Continue until the rings touch your shoulder. For many people this will feel like a very deep dip. From here push back up to support and turn the rings out to finish the rep.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 5</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=wf8tAi6sfps" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>Bent arm false grip hang</h3>
      <p class="exercise-sequence-caption">Get to position (thumbs to chest) → Hold (feet off ground)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/fgpulluptop.png" alt="Bent arm hang — pull or jump to thumbs to chest">
        <img src="assets/images/rgmuscledowndiptransition.png" alt="Bent arm hang — hold, feet off ground">
      </div>
      <p>For most people the pull up is hardest when your hands get close to touching your body. This exercise is in place to strengthen this range of motion. Pull up, or jump up into position such that your thumbs touch your chest. Hold this position with your feet off the ground.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: 10 second hold<br>Sets: 5 sets with 1 minute rest between each repetition</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=3PbCufQo_Yc&t=2s" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>False grip ring rows</h3>
      <p class="exercise-sequence-caption">Start (lean back) → Middle (thumbs to chest)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/ringrowtransistionbottom.png" alt="False grip ring row — start, arms extended">
        <img src="assets/images/ringrowtransitionmiddle.png" alt="False grip ring row — middle, thumbs to chest">
      </div>
      <p>Hold the rings in false grip, lean back holding the rings at arm's length. Maintain false grip. Row the rings in towards your body pulling until your thumbs touch your chest. Return to the straight arm position slowly.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 15</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=wC5LeDNJ1ro" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>Ring push ups with turn out</h3>
      <p class="exercise-sequence-caption">Bottom (ring to shoulder) → Top (lockout, then turn out)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/ringpushupbottom.png" alt="Ring push up — bottom, ring to shoulder">
        <img src="assets/images/ringpushuptop.png" alt="Ring push up — top, turn out">
      </div>
      <p>As in Level 1. Plank on rings, lower until ring touches shoulder, push up and externally rotate the rings.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 15<br>Sets: Complete 3–5 sets of 15 × false grip ring rows and 15 × ring push ups</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=rLTVcV6KlQ8" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>
  </div>
</section>

<!-- ============================================================
     LEVEL 4
     ============================================================ -->
<section id="level-4" class="book-section">
  <div class="chapter-opener">
    <h1>Level 4</h1>
    <div class="ch-accent"></div>
    <div class="ch-subtitle">Eccentric Control</div>
  </div>
  <div class="chapter-content">
    <p class="level-intro">As a level 4 athlete you should now be feeling quite strong on the rings. Your pull ups and dips should feel strong and you should be developing some strength in your false grip and transition. As you begin working eccentric muscle ups pay particular attention to retaining control through the transition. This is the most difficult part of the movement.</p>

    <h2 class="section-title">Mobility work</h2>
    <p class="text-small">Continue <b>False grip stretch</b> and <b>Arm extension stretch</b> as in Level 1.</p>

    <h2 class="section-title">Strength work</h2>

    <div class="exercise-block">
      <h3>Tempo eccentric ring muscle up (down)</h3>
      <p class="exercise-sequence-caption">Negative sequence: Support → Dip → Transition → Hang</p>
      <div class="exercise-sequence exercise-sequence-4">
        <img src="assets/images/rgmuscledowntop.png" alt="Negative MU — 1. Support above rings">
        <img src="assets/images/rgmuscledownbottomdip.png" alt="Negative MU — 2. Lower through dip (count of 4)">
        <img src="assets/images/rgmuscledowndiptransition.png" alt="Negative MU — 3. Lean back, thumbs around chest">
        <img src="assets/images/rgmuscledownbottom.png" alt="Negative MU — 4. Lower to hang, keep false grip">
      </div>
      <p>Begin the movement above the rings (jump or use a box to get into position). Lower through the dip slowly for a count of 4. Once you reach the bottom of the dip, lean back slowly bringing your thumbs around your chest until you are hanging at the top of the pull up position in false grip. This part of the movement is the hardest portion of the exercise. From here slowly lower down to a hang position in the rings while maintaining false grip. You have completed 1 rep.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: Maintain a tempo such that each rep takes 10 seconds<br>Sets: Complete 10 single reps; rest as much as needed between reps to ensure movement quality is maintained</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=vSv_TOU3fhk" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>False grip pull ups</h3>
      <p class="exercise-sequence-caption">Start (false grip hang) → End (thumbs to chest)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/fgringhang.png" alt="False grip pull up — start, false grip hang">
        <img src="assets/images/fgpulluptop.png" alt="False grip pull up — end, thumbs to chest">
      </div>
      <p>As in Level 3. Pull until thumbs touch chest.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 5</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=5R07lItt9EY" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <div class="exercise-block">
      <h3>Ring dips with turn out</h3>
      <p class="exercise-sequence-caption">Top (support, rings turned out) → Bottom (rings to shoulder)</p>
      <div class="exercise-sequence exercise-sequence-2">
        <img src="assets/images/rgmuscledowntop.png" alt="Ring dip — top, support, rings turned out">
        <img src="assets/images/rgmuscledownbottomdip.png" alt="Ring dip — bottom, rings to shoulder">
      </div>
      <p>As in Level 3. Rings turned out at top, lower until rings touch shoulder.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 5<br>Sets: Complete 3–5 sets of 5 × false grip pull ups and 5 × ring dips</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=wf8tAi6sfps" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>
  </div>
</section>

<!-- ============================================================
     LEVEL 5
     ============================================================ -->
<section id="level-5" class="book-section">
  <div class="chapter-opener">
    <h1>Level 5</h1>
    <div class="ch-accent"></div>
    <div class="ch-subtitle">First Muscle Up</div>
  </div>
  <div class="chapter-content">
    <p class="level-intro">By now you should have or almost be ready to attempt your first full ring muscle up. When you prepare to complete the muscle up, practice the key positions you need to hit. You have practiced them during your time working at level 4. It is tempting to begin the transition early — this is natural as it is the hardest part of the movement so you want to get it done. Resist this urge; rather ensure you complete the pull up completely with your thumbs touching your chest before pulling through the transition into the bottom position of the dip. For most people it is not easy to push out of the dip. If you are unable to push out of the dip, don't be tempted to throw your legs around and swing wildly to finish your first muscle up. Return to an earlier level and work at correcting your technique.</p>

    <h2 class="section-title">Strength work</h2>

    <div class="exercise-block">
      <h3>Ring muscle up</h3>
      <p class="exercise-sequence-caption">Full sequence: 1. Hang → 2. Pull → 3. Transition → 4. Press → 5. Support (turn out)</p>
      <div class="exercise-sequence exercise-sequence-5">
        <img src="assets/images/ringmu1.png" alt="Ring muscle up — 1. False grip hang">
        <img src="assets/images/ringmu2.png" alt="Ring muscle up — 2. Pull, thumbs to chest">
        <img src="assets/images/ringmu3.png" alt="Ring muscle up — 3. Transition, rings to armpits">
        <img src="assets/images/ringmu4.png" alt="Ring muscle up — 4. Press to support">
        <img src="assets/images/ringmu5.png" alt="Ring muscle up — 5. Support, rings turned out">
      </div>
      <p>Begin hanging under the rings in false grip. Pull up to the rings until your thumbs touch your chest. Pull the rings apart leaning forward and pulling the rings into your armpits. Once you are stable at the bottom of the dip position push up to support. Finally turn the rings out at the top. Then lower down through dip, transition and finally pull up to complete the rep hanging in false grip under the rings.</p>
      <div class="ex-box">
        <div class="ex-rx">Reps: × 10 single reps</div>
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=1_CIqS7CfwE" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>
  </div>
</section>

<!-- ============================================================
     LEVEL 6
     ============================================================ -->
<section id="level-6" class="book-section">
  <div class="chapter-opener">
    <h1>Level 6</h1>
    <div class="ch-accent"></div>
    <div class="ch-subtitle">Conditioning</div>
  </div>
  <div class="chapter-content">
    <p class="level-intro">By now you are probably stoked that you can do a ring muscle up and keen to practice the movement as often as possible. Be cautious. Just because you can do something doesn't mean you should. Many people over do the high power work (i.e. muscle up) and neglect the foundational work that got them to this point. This will increase your chance of getting injured dramatically. With this in mind, it is now time to condition yourself to the muscle up movement so that it becomes something that is easy to do. I would recommend completing the following workout every 2 or 3 days.</p>

    <h2 class="section-title">Strength work</h2>

    <div class="exercise-block">
      <h3>Muscle up conditioning</h3>
      <div class="exercise-img">
        <img src="assets/images/ringmu5.png" alt="Ring muscle up — support position, rings turned out">
      </div>
      <p>Complete the following:</p>
      <p><b>1 × ring muscle up, 3 × dips, muscle down, 3 × pull ups</b></p>
      <p>Work up to completing 10 sets of this within a 30 min window. Once that is easy move to:</p>
      <p><b>2 × ring muscle up, 6 × dips, muscle down, 6 × pull ups</b></p>
      <p>Work up to completing 10 sets of this within a 30 min window.</p>
      <div class="ex-box">
        <div class="ex-video"><a href="https://www.youtube.com/watch?v=6JcvbbIgvwc" target="_blank" rel="noopener">Watch demonstration</a></div>
      </div>
    </div>

    <hr class="accent-hr">

    <div class="closing">
      <p class="cl-main">The Wrap Up</p>
      <p class="cl-sub">At this stage the ring muscle up should feel easy. Congratulations, you have mastered the ring muscle up. Now onto bigger and better things.</p>
    </div>
  </div>
</section>

    </main><!-- end #content-area -->
  </div><!-- end #reader-body -->
</div><!-- end #reader -->

<!-- Back to Top -->
<button id="back-to-top" aria-label="Back to top">
  <svg viewBox="0 0 24 24"><polyline points="18 15 12 9 6 15"/></svg>
</button>

<!-- Toast -->
<div id="toast"></div>

<!-- JSZip for ePub generation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
/* ================================================================
   EBOOK READER — Logic
   ================================================================ */
(function() {
  'use strict';

  // ===== STATE =====
  let fontScale = 100;
  let currentTheme = 'light';
  let currentSection = 'cover';

  // ===== DOM =====
  const authGate = document.getElementById('auth-gate');
  const gateSpinner = document.getElementById('gate-spinner');
  const gateIcon = document.getElementById('gate-icon');
  const gateTitle = document.getElementById('gate-title');
  const gateMessage = document.getElementById('gate-message');
  const gateBtn = document.getElementById('gate-btn');

  const reader = document.getElementById('reader');
  const contentArea = document.getElementById('content-area');
  const progressFill = document.getElementById('progress-fill');
  const toolbarChapter = document.getElementById('toolbar-chapter');
  const toolbarSub = document.getElementById('toolbar-sub');

  const btnToc = document.getElementById('btn-toc');
  const tocSidebar = document.getElementById('toc-sidebar');
  const tocOverlay = document.getElementById('toc-overlay');
  const tocNav = document.getElementById('toc-nav');

  const btnSettings = document.getElementById('btn-settings');
  const settingsPanel = document.getElementById('settings-panel');
  const btnDownload = document.getElementById('btn-download');
  const downloadPanel = document.getElementById('download-panel');

  const fontDecrease = document.getElementById('font-decrease');
  const fontIncrease = document.getElementById('font-increase');
  const fontSizeDisplay = document.getElementById('font-size-display');

  const dlPdf = document.getElementById('dl-pdf');
  const dlEpub = document.getElementById('dl-epub');
  const backToTop = document.getElementById('back-to-top');
  const toast = document.getElementById('toast');

  const isMobile = () => window.innerWidth <= 900;

  const sections = Array.from(document.querySelectorAll('.book-section'));
  const tocLinks = Array.from(tocNav.querySelectorAll('.toc-link'));

  const chapterNames = {
    'cover': 'The Ring Muscle Up',
    'frontmatter': 'Title & Disclaimer',
    'introduction': 'Introduction',
    'benchmarking': 'Benchmarking',
    'loading': 'Loading & Deloading',
    'workouts': 'The Workouts',
    'level-1': 'Level 1 — Foundation',
    'level-2': 'Level 2 — Pull & Push',
    'level-3': 'Level 3 — False Grip',
    'level-4': 'Level 4 — Eccentric',
    'level-5': 'Level 5 — First Muscle Up',
    'level-6': 'Level 6 — Conditioning'
  };

  // ===== 1. AUTH =====
  function getSessionId() {
    return new URLSearchParams(window.location.search).get('session_id');
  }
  function isLocalDev() {
    var h = window.location.hostname;
    return h === 'localhost' || h === '127.0.0.1';
  }

  async function verifyAccess() {
    var sessionId = getSessionId();
    if (!sessionId) {
      if (isLocalDev()) { showReader(); return; }
      showGateError('Purchase Required', 'You need to purchase the guide to access this ebook.', true);
      return;
    }
    try {
      var resp = await fetch('/api/verify-session?session_id=' + encodeURIComponent(sessionId));
      var data = await resp.json().catch(function() { return {}; });
      if (resp.ok) { showReader(); }
      else {
        var msg = data.error || 'Your purchase could not be verified. Please try again or contact support.';
        showGateError('Access Denied', msg, true);
      }
    } catch (err) {
      if (isLocalDev()) { showReader(); }
      else { showGateError('Connection Error', 'We couldn\'t verify your access. Please check your connection and try again.', true); }
    }
  }

  function showGateError(title, message, showBtn) {
    gateSpinner.style.display = 'none';
    gateIcon.style.display = 'flex';
    gateTitle.textContent = title;
    gateMessage.textContent = message;
    if (showBtn) gateBtn.style.display = 'inline-block';
  }

  function showReader() {
    authGate.classList.add('hidden');
    reader.classList.add('active');
    loadPreferences();
    restoreScroll();
    updateSidebarForViewport();
  }

  // ===== 2. SCROLL PROGRESS + CHAPTER DETECTION =====
  function onContentScroll() {
    var el = contentArea;
    var scrollTop = el.scrollTop;
    var scrollMax = el.scrollHeight - el.clientHeight;
    var pct = scrollMax > 0 ? (scrollTop / scrollMax) * 100 : 0;
    progressFill.style.width = pct + '%';

    backToTop.classList.toggle('visible', scrollTop > 400);

    detectCurrentSection(scrollTop);
    saveScroll();
  }

  function detectCurrentSection(scrollTop) {
    var found = sections[0] ? sections[0].id : 'cover';
    var offset = contentArea.getBoundingClientRect().top + 100;
    for (var i = sections.length - 1; i >= 0; i--) {
      var rect = sections[i].getBoundingClientRect();
      if (rect.top <= offset) { found = sections[i].id; break; }
    }
    if (found !== currentSection) {
      currentSection = found;
      updateTocHighlight(found);
      updateToolbarTitle(found);
    }
  }

  function updateTocHighlight(sectionId) {
    tocLinks.forEach(function(link) {
      link.classList.toggle('active', link.getAttribute('data-section') === sectionId);
    });
  }

  function updateToolbarTitle(sectionId) {
    toolbarChapter.textContent = chapterNames[sectionId] || 'The Ring Muscle Up';
  }

  // ===== 3. TOC NAVIGATION =====
  function navigateToSection(sectionId) {
    var target = document.getElementById(sectionId);
    if (!target) return;
    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    if (isMobile()) closeTOC();
  }

  tocLinks.forEach(function(link) {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      navigateToSection(link.getAttribute('data-section'));
    });
  });

  function toggleTOC() {
    if (isMobile()) {
      var isOpen = tocSidebar.classList.contains('mobile-open');
      if (isOpen) closeTOC(); else openTOC();
    } else {
      tocSidebar.classList.toggle('collapsed');
    }
  }
  function openTOC() {
    tocSidebar.classList.add('mobile-open');
    tocOverlay.classList.add('visible');
  }
  function closeTOC() {
    tocSidebar.classList.remove('mobile-open');
    tocOverlay.classList.remove('visible');
  }

  function updateSidebarForViewport() {
    if (isMobile()) {
      tocSidebar.classList.remove('collapsed');
      tocSidebar.classList.remove('mobile-open');
      tocOverlay.classList.remove('visible');
    }
  }

  // ===== 4. SETTINGS =====
  function setFontScale(scale) {
    fontScale = Math.max(80, Math.min(140, scale));
    document.documentElement.style.setProperty('--font-scale', fontScale / 100);
    fontSizeDisplay.textContent = fontScale + '%';
    localStorage.setItem('ebook-font-size', fontScale);
  }

  function setTheme(theme) {
    currentTheme = theme;
    document.documentElement.setAttribute('data-theme', theme);
    document.querySelectorAll('.theme-btn').forEach(function(btn) {
      btn.classList.toggle('active', btn.dataset.theme === theme);
    });
    localStorage.setItem('ebook-theme', theme);
  }

  function loadPreferences() {
    var savedTheme = localStorage.getItem('ebook-theme');
    if (savedTheme) setTheme(savedTheme);
    var savedFontSize = localStorage.getItem('ebook-font-size');
    if (savedFontSize) { fontScale = parseInt(savedFontSize, 10); setFontScale(fontScale); }
  }

  function saveScroll() {
    localStorage.setItem('ebook-scroll', contentArea.scrollTop);
  }
  function restoreScroll() {
    var saved = localStorage.getItem('ebook-scroll');
    if (saved) contentArea.scrollTop = parseInt(saved, 10) || 0;
  }

  // ===== 5. PANELS =====
  function togglePanel(panel) {
    var isOpen = panel.classList.contains('open');
    closeAllPanels();
    if (!isOpen) panel.classList.add('open');
  }
  function closeAllPanels() {
    settingsPanel.classList.remove('open');
    downloadPanel.classList.remove('open');
  }

  // ===== 6. DOWNLOADS =====
  function downloadPDF() {
    closeAllPanels();
    window.print();
  }

  function escapeXml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  async function downloadEPub() {
    closeAllPanels();
    if (typeof JSZip === 'undefined') {
      showToast('ePub library failed to load — please refresh and try again.', 4000);
      return;
    }
    showToast('Generating ePub — this may take a moment…', 15000);

    try {
      var zip = new JSZip();
      zip.file('mimetype', 'application/epub+zip', { compression: 'STORE' });

      zip.file('META-INF/container.xml',
        '<?xml version="1.0" encoding="UTF-8"?>\n' +
        '<container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container">\n' +
        '  <rootfiles>\n' +
        '    <rootfile full-path="OEBPS/content.opf" media-type="application/oebps-package+xml"/>\n' +
        '  </rootfiles>\n' +
        '</container>'
      );

      var imgMap = {};
      var imgList = [];
      var imgEls = document.querySelectorAll('#content-area img');
      for (var i = 0; i < imgEls.length; i++) {
        var src = imgEls[i].getAttribute('src');
        if (!src || imgMap[src]) continue;
        imgMap[src] = true;
        var fname = src.split('/').pop();
        try {
          var absSrc = new URL(src, window.location.href).href;
          var resp = await fetch(absSrc);
          var blob = await resp.blob();
          imgList.push({ filename: fname, blob: blob, type: blob.type || 'image/png' });
          zip.file('OEBPS/assets/images/' + fname, blob);
        } catch (e) { /* skip failed images */ }
      }

      var epubCSS =
        'body{font-family:Georgia,"Times New Roman",serif;line-height:1.7;color:#333;margin:1em;padding:0;}\n' +
        'h1{font-size:1.6em;font-weight:bold;margin:1em 0 0.5em;line-height:1.2;}\n' +
        'h2{font-size:1.3em;font-weight:bold;margin:1.5em 0 0.5em;}\n' +
        'h3{font-size:1.1em;color:#555;font-weight:bold;margin:1em 0 0.3em;}\n' +
        'p{margin:0.6em 0;}\n' +
        'strong,b{font-weight:bold;color:#222;}\n' +
        'a{color:#8b6914;}\n' +
        'img{max-width:100%;height:auto;}\n' +
        'table{width:100%;border-collapse:collapse;margin:1em 0;}\n' +
        'th{background:#333;color:#fff;padding:0.5em;text-align:left;}\n' +
        'td{padding:0.5em;border-bottom:1px solid #ddd;vertical-align:top;}\n' +
        '.chapter-opener{padding:1.5em 1em;margin:0 -1em 1em;border-bottom:3px solid #c8a55c;}\n' +
        '.chapter-opener h1{margin:0;font-size:1.6em;}\n' +
        '.chapter-opener .ch-accent{width:40px;height:2px;background:#c8a55c;margin:0.3em 0;}\n' +
        '.chapter-opener .ch-subtitle{color:#888;font-size:0.9em;}\n' +
        '.cover-hero{text-align:center;padding:4em 1em;page-break-after:always;}\n' +
        '.cover-hero>img,.cover-overlay,.cover-brand-line{display:none;}\n' +
        '.cover-content{position:static;}\n' +
        '.cover-label{font-size:0.9em;letter-spacing:0.2em;}\n' +
        '.cover-title{font-size:2.2em;font-weight:bold;margin:0.3em 0;}\n' +
        '.cover-divider{width:60px;height:2px;background:#c8a55c;margin:0.6em auto;}\n' +
        '.cover-subtitle{color:#c8a55c;}\n' +
        '.cover-tagline{color:#888;font-style:italic;margin-top:0.3em;}\n' +
        '.cover-brand span{font-size:0.7em;text-transform:uppercase;letter-spacing:0.2em;color:#c8a55c;}\n' +
        '.title-page{text-align:center;padding:4em 1em;page-break-after:always;}\n' +
        '.title-page .accent-rule{width:60px;height:2px;background:#c8a55c;margin:0.5em auto;}\n' +
        '.title-page .subtitle{color:#c8a55c;}\n' +
        '.title-page .tagline{color:#888;}\n' +
        '.title-page .author{margin-top:2em;}\n' +
        '.disclaimer{margin-top:1.5em;}\n' +
        '.disclaimer h2{color:#888;font-size:1.1em;}\n' +
        '.disclaimer-rule{height:1px;background:#ddd;margin-bottom:1em;}\n' +
        '.disclaimer p{font-size:0.88em;color:#777;}\n' +
        '.copyright{text-align:center;margin-top:2em;}\n' +
        '.copyright p{font-size:0.75em;color:#aaa;}\n' +
        '.level-intro{font-style:italic;color:#555;padding:0.8em 1em;border-left:3px solid #c8a55c;margin:1em 0;background:#f9f9f5;}\n' +
        '.section-title{font-size:1.15em;font-weight:bold;margin:1.5em 0 0.5em;}\n' +
        '.block-heading{font-weight:bold;color:#c8a55c;margin:1.2em 0 0.2em;}\n' +
        '.exercise-block{margin:1.5em 0;padding:1em;border:1px solid #ddd;}\n' +
        '.exercise-sequence{display:flex;flex-wrap:wrap;gap:6px;margin:0.8em 0;}\n' +
        '.exercise-sequence img{width:48%;}\n' +
        '.exercise-sequence-caption{font-size:0.82em;color:#888;font-style:italic;text-align:center;margin:0.3em 0;}\n' +
        '.exercise-img{margin:0.8em 0;}\n' +
        '.exercise-img-tall{max-width:200px;margin-left:auto;margin-right:auto;}\n' +
        '.ex-box{margin-top:0.8em;padding:0.8em;background:#f5f5f5;border:1px solid #eee;}\n' +
        '.ex-rx{font-weight:bold;font-size:0.9em;line-height:1.5;}\n' +
        '.ex-video{margin-top:0.4em;font-size:0.82em;}\n' +
        '.ex-video a{color:#c8a55c;text-decoration:none;}\n' +
        '.ex-video a::before{content:"▶ ";font-size:0.8em;}\n' +
        '.callout{font-style:italic;padding:0.8em 1em;border-left:3px solid #c8a55c;margin:1em 0;background:#f9f9f5;}\n' +
        '.bench-table th:first-child{text-align:center;width:50px;}\n' +
        '.bench-table td:first-child{text-align:center;font-weight:bold;color:#c8a55c;}\n' +
        '.grad-box{border:2px solid #c8a55c;padding:0.8em;margin:1em 0;display:flex;gap:8px;}\n' +
        '.closing{text-align:center;margin-top:2em;}\n' +
        '.accent-hr{border:none;height:2px;background:#c8a55c;margin:2em 0;}\n' +
        '.text-small{font-size:0.88em;}\n';

      zip.file('OEBPS/style.css', epubCSS);

      var chaptersData = [];
      var sectionEls = document.querySelectorAll('.book-section');
      sectionEls.forEach(function(section, idx) {
        var id = section.id;
        var title = chapterNames[id] || 'Section ' + (idx + 1);
        var filename = 'chapter-' + (idx + 1) + '.xhtml';

        var clone = section.cloneNode(true);
        clone.querySelectorAll('[style]').forEach(function(el) { el.removeAttribute('style'); });

        var html = clone.innerHTML;
        var voidTags = ['br','hr','img','input','link','meta'];
        voidTags.forEach(function(tag) {
          var re = new RegExp('<(' + tag + ')(\\s[^>]*?)?\\s*>', 'gi');
          html = html.replace(re, function(m, t, attrs) {
            if (m.slice(-2) === '/>') return m;
            return '<' + t + (attrs || '') + '/>';
          });
        });

        var xhtml =
          '<?xml version="1.0" encoding="UTF-8"?>\n' +
          '<!' + 'DOCTYPE html>\n' +
          '<html xmlns="http://www.w3.org/1999/xhtml">\n' +
          '<head>\n<title>' + escapeXml(title) + '<' + '/title>\n' +
          '<' + 'link rel="stylesheet" type="text/css" href="style.css"/>\n' +
          '<' + '/head>\n<body>\n' + html + '\n<' + '/body>\n<' + '/html>';

        chaptersData.push({ id: id, title: title, filename: filename, content: xhtml });
      });

      var manifestItems = '    <item id="nav" href="toc.xhtml" media-type="application/xhtml+xml" properties="nav"/>\n' +
        '    <item id="style" href="style.css" media-type="text' + '/css"/>\n';
      var spineItems = '';

      chaptersData.forEach(function(ch, idx) {
        manifestItems += '    <item id="ch' + (idx+1) + '" href="' + ch.filename + '" media-type="application/xhtml+xml"/>\n';
        spineItems += '    <itemref idref="ch' + (idx+1) + '"/>\n';
      });
      imgList.forEach(function(img, idx) {
        var mt = img.type.indexOf('png') >= 0 ? 'image/png' : img.type.indexOf('jpeg') >= 0 ? 'image/jpeg' : 'image/png';
        manifestItems += '    <item id="img' + idx + '" href="assets/images/' + escapeXml(img.filename) + '" media-type="' + mt + '"/>\n';
      });

      var now = new Date().toISOString().replace(/\.\d+Z$/, 'Z');
      var opf =
        '<?xml version="1.0" encoding="UTF-8"?>\n' +
        '<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="uid">\n' +
        '  <metadata xmlns:dc="http://purl.org/dc/elements/1.1/">\n' +
        '    <dc:identifier id="uid">ring-muscle-up-guide-v1</dc:identifier>\n' +
        '    <dc:title>The Ring Muscle Up — The Complete Training Guide</dc:title>\n' +
        '    <dc:creator>The Bodyweight Gym</dc:creator>\n' +
        '    <dc:language>en</dc:language>\n' +
        '    <meta property="dcterms:modified">' + now + '</meta>\n' +
        '  </metadata>\n' +
        '  <manifest>\n' + manifestItems + '  </manifest>\n' +
        '  <spine>\n' + spineItems + '  </spine>\n' +
        '</package>';
      zip.file('OEBPS/content.opf', opf);

      var tocOl = '';
      chaptersData.forEach(function(ch) {
        tocOl += '      <li><a href="' + ch.filename + '">' + escapeXml(ch.title) + '</a></li>\n';
      });
      var tocXhtml =
        '<?xml version="1.0" encoding="UTF-8"?>\n' +
        '<!' + 'DOCTYPE html>\n' +
        '<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">\n' +
        '<head><title>Contents<' + '/title>\n' +
        '<' + 'link rel="stylesheet" type="text/css" href="style.css"/>\n' +
        '<' + '/head>\n<body>\n' +
        '  <nav epub:type="toc">\n' +
        '    <h1>Contents<' + '/h1>\n' +
        '    <ol>\n' + tocOl + '    <' + '/ol>\n' +
        '  <' + '/nav>\n' +
        '<' + '/body>\n<' + '/html>';
      zip.file('OEBPS/toc.xhtml', tocXhtml);

      chaptersData.forEach(function(ch) { zip.file('OEBPS/' + ch.filename, ch.content); });

      var epubBlob = await zip.generateAsync({
        type: 'blob',
        mimeType: 'application/epub+zip',
        compression: 'DEFLATE',
        compressionOptions: { level: 9 }
      });

      var a = document.createElement('a');
      a.href = URL.createObjectURL(epubBlob);
      a.download = 'The-Ring-Muscle-Up-Guide.epub';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(a.href);

      showToast('ePub downloaded successfully!', 3000);
    } catch (err) {
      console.error('ePub generation failed:', err);
      showToast('ePub generation failed — please try PDF instead.', 5000);
    }
  }

  // ===== 7. TOAST =====
  function showToast(msg, duration) {
    toast.textContent = msg;
    toast.classList.add('visible');
    setTimeout(function() { toast.classList.remove('visible'); }, duration || 3000);
  }

  // ===== 8. IN-CONTENT TOC LINKS =====
  document.querySelectorAll('.book-toc .toc-item').forEach(function(item) {
    item.addEventListener('click', function() {
      var text = item.textContent.trim().toLowerCase();
      for (var key in chapterNames) {
        if (chapterNames[key].toLowerCase().indexOf(text.substring(0, 8)) >= 0) {
          navigateToSection(key);
          break;
        }
      }
    });
  });

  // ===== 9. EVENT LISTENERS =====
  contentArea.addEventListener('scroll', onContentScroll, { passive: true });

  btnToc.addEventListener('click', toggleTOC);
  tocOverlay.addEventListener('click', closeTOC);

  btnSettings.addEventListener('click', function(e) {
    e.stopPropagation();
    downloadPanel.classList.remove('open');
    togglePanel(settingsPanel);
  });
  btnDownload.addEventListener('click', function(e) {
    e.stopPropagation();
    settingsPanel.classList.remove('open');
    togglePanel(downloadPanel);
  });

  document.addEventListener('click', function(e) {
    if (!settingsPanel.contains(e.target) && !btnSettings.contains(e.target) &&
        !downloadPanel.contains(e.target) && !btnDownload.contains(e.target)) {
      closeAllPanels();
    }
  });

  settingsPanel.addEventListener('click', function(e) { e.stopPropagation(); });
  downloadPanel.addEventListener('click', function(e) { e.stopPropagation(); });

  fontDecrease.addEventListener('click', function() { setFontScale(fontScale - 10); });
  fontIncrease.addEventListener('click', function() { setFontScale(fontScale + 10); });

  document.querySelectorAll('.theme-btn').forEach(function(btn) {
    btn.addEventListener('click', function() { setTheme(btn.dataset.theme); });
  });

  dlPdf.addEventListener('click', downloadPDF);
  dlEpub.addEventListener('click', downloadEPub);

  backToTop.addEventListener('click', function() {
    contentArea.scrollTo({ top: 0, behavior: 'smooth' });
  });

  document.addEventListener('keydown', function(e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
    if (e.key === 'Escape') { closeTOC(); closeAllPanels(); }
  });

  window.addEventListener('resize', function() { updateSidebarForViewport(); });

  // ===== INIT =====
  verifyAccess();

})();
</script>
</body>
</html>
